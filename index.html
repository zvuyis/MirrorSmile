<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MirrorSmile</title>
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"></script>
    <style>
        :root { --accent: #4ebaba; --bg-glass: rgba(15, 20, 25, 0.9); --text-main: #e0e0e0; }
        body { margin: 0; background: #0a0c10; overflow: hidden; font-family: 'Segoe UI', Roboto, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; color: var(--text-main); }
        
        .screen { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; flex-direction: column; z-index: 200; transition: opacity 0.4s ease; padding: 20px; box-sizing: border-box; }
        canvas { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); max-width: 100%; max-height: 100%; object-fit: contain; display: none; }
        video { display: none; }

        /* ×›×¨×˜×™×¡ ×ª×•×›×Ÿ */
        .content-card { 
            text-align: center; padding: 30px; max-width: 500px; max-height: 85vh;
            background: var(--bg-glass); border-radius: 30px; backdrop-filter: blur(15px); 
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 15px 35px rgba(0,0,0,0.5); 
            overflow-y: auto; scrollbar-width: thin;
        }
        
        #app-logo { width: 100px; height: 100px; margin-bottom: 20px; border-radius: 50%; border: 1px solid var(--accent); background: #fff; object-fit: contain; padding: 5px; }
        h1 { font-size: 32px; margin: 0 0 20px 0; color: #fff; }
        h2 { font-size: 22px; color: var(--accent); margin-bottom: 15px; border-bottom: 1px solid rgba(78, 186, 186, 0.3); padding-bottom: 10px; }
        
        .intro-text { font-size: 15px; line-height: 1.6; margin-bottom: 25px; text-align: right; font-weight: 300; color: #f0f0f0; }
        .intro-text p { margin-bottom: 15px; }

        /* ×›×¤×ª×•×¨×™× */
        .btn-group { display: flex; flex-direction: column; gap: 10px; width: 100%; align-items: center; }
        .about-footer-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 320px; margin-bottom: 5px; }
        .main-btn { width: 100%; max-width: 280px; padding: 14px; border-radius: 30px; background: var(--accent); color: #000; font-size: 17px; font-weight: 600; border: none; cursor: pointer; transition: transform 0.2s; }
        .secondary-btn { width: 100%; max-width: 280px; padding: 12px; border-radius: 30px; background: transparent; color: var(--accent); font-size: 16px; border: 1px solid var(--accent); cursor: pointer; }
        .tiny-btn { width: 100%; padding: 10px; border-radius: 15px; background: rgba(255,255,255,0.05); color: #fff; font-size: 13px; border: 1px solid rgba(255,255,255,0.2); cursor: pointer; }
        .disclaimer-link { background: none; border: none; color: #aaa; text-decoration: underline; font-size: 12px; cursor: pointer; margin-top: 10px; opacity: 0.7; }

        /* ×—×œ×•×Ÿ ××•×“××œ×™ (Pop-up) */
        .modal { display: none; position: fixed; z-index: 300; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); justify-content: center; align-items: center; }
        .modal-content { background: #1a1e23; padding: 25px; border-radius: 20px; width: 85%; max-width: 400px; text-align: right; border: 1px solid var(--accent); box-shadow: 0 0 20px rgba(78, 186, 186, 0.2); }
        .modal-content h3 { color: var(--accent); margin-top: 0; }
        .close-modal { width: 100%; margin-top: 20px; padding: 10px; background: var(--accent); border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }

        /* ×××©×§ ××¦×œ××” */
        #ui { position: absolute; bottom: 35px; width: 100%; display: none; flex-direction: column; align-items: center; gap: 15px; z-index: 100; }
        .controls-row { display: flex; gap: 10px; justify-content: center; }
        button.tool-btn { padding: 12px 16px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: #fff; cursor: pointer; }
        button.active { background: var(--accent); color: #000; }
        #slider-container { width: 80%; max-width: 350px; background: rgba(0,0,0,0.4); padding: 12px 20px; border-radius: 20px; }
        input[type=range] { width: 100%; accent-color: var(--accent); }
        .watermark { position: absolute; bottom: 8px; font-size: 10px; color: rgba(255,255,255,0.25); z-index: 210; width: 100%; text-align: center; pointer-events: none; }
    </style>
</head>
<body>

    <div id="screen-1" class="screen">
        <div class="content-card">
            <img src="logo.png" id="app-logo" alt="MirrorSmile Logo">
            <h1>MirrorSmile</h1>
            <div class="btn-group">
                <button class="main-btn" onclick="showScreen(3)">×œ×”×•×¨××•×ª ×”×©×™××•×©</button>
                <button class="secondary-btn" onclick="showScreen(2)">××•×“×•×ª ×”××¤×œ×™×§×¦×™×”</button>
            </div>
        </div>
    </div>

    <div id="screen-2" class="screen" style="display:none; opacity:0;">
        <div class="content-card">
            <h2>××•×“×•×ª MirrorSmile</h2>
            <div class="intro-text">
                <p>MirrorSmile × ×•×œ×“×” ××ª×•×š ×¢×§×¨×•×Ÿ <strong>×”× ×•×™×¨×•×¤×œ×¡×˜×™×•×ª</strong> â€” ×™×›×•×œ×ª×• ×©×œ ×”××•×— ×œ×”×©×ª× ×•×ª, ×œ×”×¡×ª×’×œ ×•×œ×”×—×œ×™× ×‘×¢×§×‘×•×ª ××™××•×Ÿ, ×—×–×¨×” ×•××©×•×‘ ××ª××™×.</p>
                <p>×¢×™×§×¨×•×Ÿ ×–×” ××ª×•××¨ ×‘×”×¨×—×‘×” ×‘×¡×¤×¨ â€×”××•×— ×”×’××™×©â€ (The Brain That Changes Itself) ×××ª × ×•×¨××Ÿ ×“×•×™×“×’â€™, ×”××“×’×™× ×›×™×¦×“ ×ª×”×œ×™×›×™ ××™××•×Ÿ ××›×•×•× ×™× ×™×›×•×œ×™× ×œ×”×©×¤×™×¢ ×¢×œ ×ª×¤×§×•×“ ××•×—×™ ×•×©×™×§×•××™. ×‘×¤×¨×§ 7 ×‘×¡×¤×¨ ××ª×•××¨×ª ×‘×™×Ÿ ×”×©××¨ ×ª×¨×•××ª×• ×©×œ ×¤×¨×•×¤â€™ ×¨×××¦â€™× ×“×¨×Ÿ ×œ×©×“×” ×–×”.</p>
                <p>×”××¤×œ×™×§×¦×™×” ××‘×•×¡×¡×ª ×¢×œ ×¢×§×¨×•× ×•×ª <strong>Mirror Therapy</strong> â€” ×©×™×˜×” ×©×™×§×•××™×ª ×”××©×ª××©×ª ×‘××©×•×‘ ×—×–×•×ª×™ ×›×“×™ ×œ×¢×•×“×“ ×”×¤×¢×œ×” ××•×—×™×ª ×•×ª× ×•×¢×ª×™×ª.</p>
                <p>×”×©×™×˜×” ×¤×•×ª×—×” ×‘×©× ×•×ª ×”â€‘90 ×¢×œâ€‘×™×“×™ ×”× ×•×™×¨×•×œ×•×’ Vilayanur Subramanian Ramachandran, ×ª×—×™×œ×” ×œ×˜×™×¤×•×œ ×‘×›××‘×™ ×¤× ×˜×•× ×œ××—×¨ ×§×˜×™×¢×ª ×’×¤×™×™×, ×•×‘×”××©×š ×™×•×©××” ×’× ×‘×©×™×§×•× ××•×˜×•×¨×™ ×•× ×•×™×¨×•×œ×•×’×™, ×›×•×œ×œ ×©×™×ª×•×§×™ ×¤× ×™×.</p>
            </div>
            
            <div class="btn-group">
                <div class="about-footer-btns">
                    <button class="tiny-btn" onclick="openModal('usersModal')">×§×¨×™××” ×œ××©×ª××©×™×</button>
                    <button class="tiny-btn" onclick="openModal('researchModal')">×§×¨×™××” ×œ×—×•×§×¨×™×</button>
                </div>
                <button class="disclaimer-link" onclick="openModal('disclaimerModal')">××—×¨×™×•×ª ×”×©×™××•×©</button>
                <br>
                <button class="main-btn" onclick="showScreen(3)">×œ×”××©×š ×œ×”×•×¨××•×ª</button>
            </div>
        </div>
    </div>

    <div id="usersModal" class="modal">
        <div class="modal-content">
            <h3>×§×¨×™××” ×œ××©×ª××©×™×</h3>
            <p>×× ×• ××–××™× ×™× ×× ×©×™× ×”×¡×•×‘×œ×™× ××©×™×ª×•×§ ×¢×¦×‘ ×”×¤× ×™× ×œ×”×©×ª××© ×‘â€‘MirrorSmile ×›×—×œ×§ ××ª×”×œ×™×š ×”×”×—×œ××”, ×‘×§×¦×‘ ××™×©×™, ×‘×¡×‘×œ× ×•×ª ×•×‘×”×§×©×‘×” ×œ×’×•×£.</p>
            <p>× ×©××— ×œ×§×‘×œ ××©×•×‘, ×—×•×•×™×•×ª ×©×™××•×©, ×”×¦×¢×•×ª ×œ×©×™×¤×•×¨ ×•×¨×¢×™×•× ×•×ª ×œ×¤×™×ª×•×— ×¢×ª×™×“×™.</p>
            <button class="close-modal" onclick="closeModal('usersModal')">×¡×’×•×¨</button>
        </div>
    </div>

    <div id="researchModal" class="modal">
        <div class="modal-content">
            <h3>×§×¨×™××” ×œ×—×•×§×¨×™×</h3>
            <p>×—×•×§×¨×™×, ×¨×•×¤××™× ×•××•×¡×“×•×ª ××§×“××™×™× ××•×–×× ×™× ×œ×”×©×ª××© ×‘â€‘MirrorSmile ×œ×œ× ×ª××•×¨×”, ×œ×¦×•×¨×›×™ ××—×§×¨ ×¨×¤×•××™â€‘××“×¢×™.</p>
            <p><strong>×ª× ××™ ×™×—×™×“:</strong> ×›×œ ×¤×¨×¡×•×, ××××¨ ××• ×¢×‘×•×“×” ××§×“××™×ª ×”××‘×•×¡×¡×™× ×¢×œ ×©×™××•×© ×‘××¤×œ×™×§×¦×™×” ×™×›×œ×œ×• ×¨×¤×¨× ×¡ ×‘×¨×•×¨ ××œ ×“×§×œ ×¦×™×“×•×Ÿ, ×™×©×™ ×–×‘×•×œ×•×Ÿ ×•××¤×œ×™×§×¦×™×™×ª MirrorSmile.</p>
            <button class="close-modal" onclick="closeModal('researchModal')">×¡×’×•×¨</button>
        </div>
    </div>

    <div id="disclaimerModal" class="modal">
        <div class="modal-content">
            <h3>×—×©×•×‘ ×œ×“×¢×ª</h3>
            <p>××¤×œ×™×§×¦×™×” ×–×• ××™× ×” ××›×©×™×¨ ×¨×¤×•××™ ×•××™× ×” ××”×•×•×” ×™×™×¢×•×¥ ×¨×¤×•××™, ××‘×—×•×Ÿ ××• ×˜×™×¤×•×œ. ×”×©×™××•×© ×‘××¤×œ×™×§×¦×™×” × ×¢×©×” ×‘××—×¨×™×•×ª ×”××©×ª××© ×‘×œ×‘×“.</p>
            <p>××™×Ÿ ×œ×”×¤×¡×™×§ ××• ×œ×©× ×•×ª ×˜×™×¤×•×œ ×¨×¤×•××™, ×¤×™×–×™×•×ª×¨×¤×™ ××• ××¢×§×‘ ×§×œ×™× ×™ ×œ×œ× ×”×ª×™×™×¢×¦×•×ª ×¢× ×¨×•×¤×. ×‘××§×¨×” ×©×œ ×›××‘ ××• ×”×—××¨×” â€” ×™×© ×œ×”×¤×¡×™×§ ××ª ×”×©×™××•×© ×•×œ×¤× ×•×ª ×œ××™×© ××§×¦×•×¢.</p>
            <button class="close-modal" onclick="closeModal('disclaimerModal')">×”×‘× ×ª×™</button>
        </div>
    </div>

    <div id="screen-3" class="screen" style="display:none; opacity:0;">
        <div class="content-card">
            <h2>××™×š ×–×” ×¢×•×‘×“?</h2>
            <ul style="text-align: right; line-height: 1.8; margin-bottom: 25px; padding-right: 20px;">
                <li>×¢××“×• ××•×œ ×”××¦×œ××” ×•×”×‘×™×˜×• ×§×“×™××” ×‘×§×• ×™×©×¨.</li>
                <li>×‘×—×¨×• ××ª ×”×¦×“ ×”×‘×¨×™× (×™××™×Ÿ/×©×××œ) ×›×“×™ ×œ×©×§×£ ××•×ª×• ×¢×œ ×”×¦×“ ×”××©×•×ª×§.</li>
                <li>×”×©×ª××©×• ×‘×¡×œ×™×™×“×¨ ×œ×›×™×•×•× ×•×Ÿ ×™×“× ×™ ××“×•×™×§ ×‘××™×“×ª ×”×¦×•×¨×š.</li>
            </ul>
            <button class="main-btn" onclick="startCamera()">×”×‘× ×ª×™, ×‘×•××• × ×ª×—×™×œ</button>
        </div>
    </div>

    <video id="videoElement" playsinline autoplay muted></video>
    <canvas id="mainCanvas"></canvas>
    <canvas id="tempCanvas" style="display:none"></canvas>
    <div id="ui">
        <div id="slider-container">
            <input type="range" id="symmetrySlider" min="0" max="100" value="50" oninput="manualAdjust(this.value)">
            <div style="display:flex; justify-content:space-between; font-size:10px; opacity:0.7;"><span>×™×“× ×™</span><span onclick="resetAuto()" style="cursor:pointer; text-decoration:underline;">××•×˜×•××˜×™ ğŸ”„</span></div>
        </div>
        <div class="controls-row">
            <button onclick="setMode('none')" id="btnNone" class="tool-btn active">×¨×’×™×œ</button>
            <button onclick="setMode('left')" id="btnLeft" class="tool-btn">×©×××œ</button>
            <button onclick="setMode('right')" id="btnRight" class="tool-btn">×™××™×Ÿ</button>
            <button onclick="toggleGuide()" id="btnGuide" class="tool-btn">ğŸ‘ï¸</button>
            <button onclick="takeSnapshot()" class="tool-btn">ğŸ“¸</button>
        </div>
    </div>
    <div class="watermark">Â© 2026 | MirrorSmile | Developed by Dekel Tzidon & Yishay Zvulun</div>

    <script>
        const video = document.getElementById('videoElement');
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const tempCanvas = document.getElementById('tempCanvas');
        const tCtx = tempCanvas.getContext('2d');
        const slider = document.getElementById('symmetrySlider');
        let currentMode = 'none', smoothNoseX = 0, selfieSegmentation, isManual = false, showGuide = true;

        function showScreen(num) {
            document.querySelectorAll('.screen').forEach(s => { s.style.opacity = '0'; setTimeout(() => s.style.display = 'none', 400); });
            setTimeout(() => { const t = document.getElementById('screen-' + num); t.style.display = 'flex'; setTimeout(() => t.style.opacity = '1', 50); }, 450);
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        async function startCamera() {
            document.querySelectorAll('.screen').forEach(s => s.style.opacity = '0');
            setTimeout(() => { document.querySelectorAll('.screen').forEach(s => s.style.display = 'none'); canvas.style.display = 'block'; document.getElementById('ui').style.display = 'flex'; }, 450);
            await initModels();
        }

        async function initModels() {
            await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
            await faceapi.nets.faceLandmark68Net.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
            selfieSegmentation = new SelfieSegmentation({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`});
            selfieSegmentation.setOptions({ modelSelection: 1 });
            selfieSegmentation.onResults(onResults);
            const s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
            video.srcObject = s;
            video.onloadedmetadata = () => { canvas.width = tempCanvas.width = video.videoWidth; canvas.height = tempCanvas.height = video.videoHeight; smoothNoseX = canvas.width/2; sendToSegmentation(); };
        }

        async function sendToSegmentation() { if (!video.paused && !video.ended) await selfieSegmentation.send({image: video}); requestAnimationFrame(sendToSegmentation); }

        function onResults(r) {
            tCtx.save(); tCtx.clearRect(0,0,canvas.width,canvas.height); tCtx.translate(canvas.width,0); tCtx.scale(-1,1);
            tCtx.drawImage(r.segmentationMask, 0,0,canvas.width,canvas.height);
            tCtx.globalCompositeOperation = 'source-in'; tCtx.drawImage(r.image, 0,0,canvas.width,canvas.height); tCtx.restore();

            handleFaceDetection();
            ctx.clearRect(0,0,canvas.width,canvas.height);
            if(currentMode==='none') ctx.drawImage(tempCanvas,0,0);
            else if(currentMode==='left') drawSymmetry(0, smoothNoseX);
            else drawSymmetry(smoothNoseX, canvas.width - smoothNoseX);

            if(showGuide && (isManual || currentMode!=='none')) {
                ctx.beginPath(); ctx.strokeStyle='rgba(78,186,186,0.4)'; ctx.moveTo(smoothNoseX,0); ctx.lineTo(smoothNoseX,canvas.height); ctx.stroke();
            }
        }

        async function handleFaceDetection() {
            if(!isManual) {
                const d = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks();
                if(d.length > 0) {
                    const nx = canvas.width - d[0].landmarks.getNose()[0].x;
                    smoothNoseX += (nx - smoothNoseX) * 0.15;
                    slider.value = (smoothNoseX/canvas.width)*100;
                }
            }
        }

        function drawSymmetry(sx, w) {
            ctx.drawImage(tempCanvas, sx, 0, w, canvas.height, sx, 0, w, canvas.height);
            ctx.save(); ctx.translate(smoothNoseX * 2, 0); ctx.scale(-1, 1);
            ctx.drawImage(tempCanvas, sx, 0, w, canvas.height, sx, 0, w, canvas.height); ctx.restore();
        }

        function manualAdjust(v) { isManual = true; smoothNoseX = (v/100)*canvas.width; }
        function resetAuto() { isManual = false; }
        function toggleGuide() { showGuide = !showGuide; }
        function setMode(m) { currentMode = m; document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active')); if(m!=='none') document.getElementById('btn'+m.charAt(0).toUpperCase()+m.slice(1)).classList.add('active'); else document.getElementById('btnNone').classList.add('active'); }
        function takeSnapshot() { const l = document.createElement('a'); l.download = 'MirrorSmile.png'; l.href = canvas.toDataURL(); l.click(); }
    </script>
</body>
</html>
