<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MirrorFace</title>
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"></script>
    <style>
        * { box-sizing: border-box; }
        :root { --accent: #4ebaba; --bg-glass: rgba(15, 20, 25, 0.92); --text-main: #e0e0e0; --warning: #ffb74d; }
        
        body { margin: 0; background: #0a0c10; overflow: hidden; font-family: 'Segoe UI', Roboto, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; color: var(--text-main); }
        
        .screen { position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; flex-direction: column; z-index: 200; transition: opacity 0.4s ease; padding: 20px; }
        
        canvas { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); max-width: 100%; max-height: 100%; object-fit: contain; display: none; }
        video { display: none; }

        .content-card { 
            text-align: center; padding: 25px; width: 90vw; max-width: 450px; max-height: 85vh;
            background: var(--bg-glass); border-radius: 30px; backdrop-filter: blur(15px); 
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 15px 35px rgba(0,0,0,0.5); 
            overflow-y: auto; scrollbar-width: none; -ms-overflow-style: none;
        }
        .content-card::-webkit-scrollbar { display: none; }
        
        #app-logo { width: 80px; height: 80px; margin-bottom: 15px; border-radius: 50%; border: 1px solid var(--accent); background: #fff; object-fit: contain; padding: 5px; }
        h1 { font-size: 28px; margin: 0 0 5px 0; color: #fff; }
        .sub-title { font-size: 14px; color: var(--accent); margin-bottom: 20px; opacity: 0.9; line-height: 1.4; }
        h2 { font-size: 19px; color: var(--accent); margin-bottom: 15px; border-bottom: 1px solid rgba(78, 186, 186, 0.3); padding-bottom: 8px; }
        
        .info-text { text-align: right; font-size: 13.5px; line-height: 1.6; margin-bottom: 20px; color: #f0f0f0; }
        .info-text p { margin-bottom: 12px; }

        .instructions-list { text-align: right; margin: 15px 0; padding: 0; list-style: none; width: 100%; }
        .instructions-list li { margin-bottom: 12px; font-size: 13px; line-height: 1.5; display: flex; align-items: flex-start; gap: 8px; }
        .instructions-list li::before { content: "â€¢"; color: var(--accent); font-weight: bold; flex-shrink: 0; margin-top: 2px; }
        .instruction-goal { font-size: 12.5px; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; font-style: italic; opacity: 0.9; }

        .btn-group { display: flex; flex-direction: column; gap: 10px; width: 100%; align-items: center; }
        .main-btn { width: 100%; max-width: 260px; padding: 12px; border-radius: 30px; background: var(--accent); color: #000; font-size: 16px; font-weight: 600; border: none; cursor: pointer; transition: 0.2s; }
        .secondary-btn { width: 100%; max-width: 260px; padding: 10px; border-radius: 30px; background: transparent; color: var(--accent); font-size: 14px; border: 1px solid var(--accent); cursor: pointer; }
        
        .disclaimer-box { background: rgba(255, 183, 77, 0.1); border: 1px solid var(--warning); padding: 15px; border-radius: 20px; text-align: right; margin-bottom: 20px; width: 100%; }
        .disclaimer-box h3 { color: var(--warning); margin-top: 0; font-size: 16px; }
        .disclaimer-box p { font-size: 12px; line-height: 1.4; margin-bottom: 8px; }

        .modal { display: none; position: fixed; z-index: 300; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); justify-content: center; align-items: center; }
        .modal-content { background: #1a1e23; padding: 20px; border-radius: 20px; width: 85%; max-width: 380px; text-align: right; border: 1px solid var(--accent); }
        .close-modal { width: 100%; margin-top: 15px; padding: 10px; background: var(--accent); border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }

        #ui { position: absolute; bottom: 40px; width: 100%; display: none; flex-direction: column; align-items: center; gap: 15px; z-index: 100; padding: 0 10px; }
        .controls-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        button.tool-btn { padding: 10px 14px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.1); color: #fff; cursor: pointer; font-size: 14px; }
        button.active { background: var(--accent); color: #000; }
        #slider-container { width: 90%; max-width: 320px; background: rgba(0,0,0,0.4); padding: 12px 20px; border-radius: 20px; }
        input[type=range] { width: 100%; accent-color: var(--accent); }
        .watermark { position: absolute; bottom: 10px; font-size: 10px; color: rgba(255,255,255,0.25); z-index: 210; width: 100%; text-align: center; pointer-events: none; }
    </style>
</head>
<body>

    <div id="screen-1" class="screen">
        <div class="content-card">
            <img src="logo.png" id="app-logo" alt="MirrorFace Logo">
            <h1>MirrorFace</h1>
            <div class="sub-title">×¤×•×ª×—×” ×¢×œ ×™×“×™ ×“×§×œ ×¦×™×“×•×Ÿ ×•×™×©×™ ×–×‘×•×œ×•×Ÿ</div>
            <div class="btn-group">
                <button class="main-btn" onclick="showScreen(3)">×œ×”×•×¨××•×ª ×”×©×™××•×©</button>
                <button class="secondary-btn" onclick="showScreen(2)">××•×“×•×ª ×”××¤×œ×™×§×¦×™×”</button>
            </div>
        </div>
    </div>

    <div id="screen-2" class="screen" style="display:none; opacity:0;">
        <div class="content-card">
            <h2>××•×“×•×ª MirrorFace</h2>
            <div class="info-text">
                <p><strong>MirrorFace</strong> × ×•×œ×“×” ××ª×•×š ×¢×§×¨×•×Ÿ ×”× ×•×™×¨×•×¤×œ×¡×˜×™×•×ª â€” ×™×›×•×œ×ª×• ×©×œ ×”××•×— ×œ×”×©×ª× ×•×ª, ×œ×”×¡×ª×’×œ ×•×œ×”×—×œ×™× ×‘×¢×§×‘×•×ª ××™××•×Ÿ, ×—×–×¨×” ×•××©×•×‘ ××ª××™×.</p>
                <p>×¢×™×§×¨×•×Ÿ ×–×” ××ª×•××¨ ×‘×”×¨×—×‘×” ×‘×¡×¤×¨ â€×”××•×— ×”×’××™×©â€ (The Brain That Changes Itself) ×××ª × ×•×¨××Ÿ ×“×•×™×“×’â€™, ×”××“×’×™× ×›×™×¦×“ ×ª×”×œ×™×›×™ ××™××•×Ÿ ××›×•×•× ×™× ×™×›×•×œ×™× ×œ×”×©×¤×™×¢ ×¢×œ ×ª×¤×§×•×“ ××•×—×™ ×•×©×™×§×•××™. ×‘×¤×¨×§ 7 ×‘×¡×¤×¨ ××ª×•××¨×ª ×‘×™×Ÿ ×”×©××¨ ×ª×¨×•××ª×• ×©×œ ×¤×¨×•×¤â€™ ×¨×××¦â€™× ×“×¨×Ÿ ×œ×©×“×” ×–×”.</p>
                <p>×”××¤×œ×™×§×¦×™×” ××‘×•×¡×¡×ª ×¢×œ ×¢×§×¨×•× ×•×ª Mirror Therapy â€” ×©×™×˜×” ×©×™×§×•××™×ª ×”××©×ª××©×ª ×‘××©×•×‘ ×—×–×•×ª×™ ×›×“×™ ×œ×¢×•×“×“ ×”×¤×¢×œ×” ××•×—×™×ª ×•×ª× ×•×¢×ª×™×ª.</p>
                <p>×”×©×™×˜×” ×¤×•×ª×—×” ×¢×œâ€‘×™×“×™ ×”× ×•×™×¨×•×œ×•×’ <strong>Vilayanur S. Ramachandran</strong>, ×ª×—×™×œ×” ×œ×˜×™×¤×•×œ ×‘×›××‘×™ ×¤× ×˜×•× ×•×‘×”××©×š ×™×•×©××” ×’× ×‘×©×™×§×•× ××•×˜×•×¨×™ ×•× ×•×™×¨×•×œ×•×’×™, ×›×•×œ×œ ×©×™×ª×•×§×™ ×¤× ×™×.</p>
            </div>
            <div class="btn-group">
                <button class="secondary-btn" onclick="openModal('usersModal')">×§×¨×™××” ×œ××©×ª××©×™×</button>
                <button class="secondary-btn" onclick="openModal('researchModal')">×§×¨×™××” ×œ×—×•×§×¨×™×</button>
                <button class="main-btn" onclick="showScreen(3)">×œ×”××©×š ×œ×”×•×¨××•×ª</button>
            </div>
        </div>
    </div>

    <div id="screen-3" class="screen" style="display:none; opacity:0;">
        <div class="content-card">
            <h2>×”×•×¨××•×ª ×©×™××•×©</h2>
            <ul class="instructions-list">
                <li>×”×¦×‘ ××ª ×”××›×©×™×¨ ×¢×œ ×—×¦×•×‘×”, ×™×©×™×¨×•×ª ××•×œ ×”×¤× ×™× â€” ×‘×“×•××” ×œ××¨××”</li>
                <li>×“××’ ×œ×ª××•×¨×” ××—×™×“×”, ×¡×‘×™×‘×” ×©×§×˜×” ×•×¤×¨×˜×™×•×ª</li>
                <li>××§× ××ª ×”×¤× ×™× ×‘××¨×›×– ×”××¡×š, ××‘×˜ ×™×©×¨ ×§×“×™××”</li>
                <li>×©×›×¤×œ ××ª ×”×¦×“ ×”×‘×¨×™× ×•×—×¤×© ×¡×™××˜×¨×™×” × ×•×—×” ×•×˜×‘×¢×™×ª</li>
                <li>×ª×¨×’×œ ×‘×¢×–×¨×ª ×©×ª×™ ×”×™×“×™×™× ×‘××§×‘×™×œ, ×‘×”×ª×× ×œ×”× ×—×™×•×ª ×”××˜×¤×œ ×©×œ×š</li>
            </ul>
            <div class="info-text instruction-goal">
                ××˜×¨×ª ×”×ª×¨×’×•×œ ×”×™× ×œ××¤×©×¨ ×œ××•×— â€×œ×”×©×ª×›× ×¢â€ ×©×”×ª× ×•×¢×” ××¤×©×¨×™×ª, ×‘×˜×•×—×” ×•×ª×§×™× ×” â€” ×•×œ×ª××•×š ×‘×ª×”×œ×™×š ×”×œ××™×“×”â€‘××—×“×©.
            </div>
            <button class="main-btn" onclick="showScreen(4)">×”××©×š ×œ××—×¨×™×•×ª ×©×™××•×©</button>
        </div>
    </div>

    <div id="screen-4" class="screen" style="display:none; opacity:0;">
        <div class="content-card">
            <div class="disclaimer-box">
                <h3>××—×¨×™×•×ª ×”××©×ª××©</h3>
                <p>××¤×œ×™×§×¦×™×” ×–×• ××™× ×” ××›×©×™×¨ ×¨×¤×•××™ ×•××™× ×” ××”×•×•×” ×™×™×¢×•×¥ ×¨×¤×•××™.</p>
                <p>×”×©×™××•×© × ×¢×©×” ×‘××—×¨×™×•×ª ×”××©×ª××© ×‘×œ×‘×“. ××™×Ÿ ×œ×©× ×•×ª ×˜×™×¤×•×œ ×œ×œ× ×”×ª×™×™×¢×¦×•×ª ×¢× ×¨×•×¤×.</p>
                <p>×‘××§×¨×” ×©×œ ×›××‘ ××• ×¡×¤×§ â€” ×™×© ×œ×”×¤×¡×™×§ ××ª ×”×©×™××•×© ×•×œ×¤× ×•×ª ×œ××™×© ××§×¦×•×¢.</p>
            </div>
            <button class="main-btn" onclick="startCamera()">×”×‘× ×ª×™, ×‘×•××• × ×ª×—×™×œ</button>
        </div>
    </div>

    <div id="usersModal" class="modal"><div class="modal-content"><h3>×§×¨×™××” ×œ××©×ª××©×™×</h3><p>×× ×• ××–××™× ×™× ×× ×©×™× ×”×¡×•×‘×œ×™× ××©×™×ª×•×§ ×¢×¦×‘ ×”×¤× ×™× ×œ×”×©×ª××© ×‘â€‘MirrorFace ×›×—×œ×§ ××ª×”×œ×™×š ×”×”×—×œ××”. × ×©××— ×œ×§×‘×œ ××©×•×‘ ×•×”×¦×¢×•×ª ×œ×©×™×¤×•×¨.</p><button class="close-modal" onclick="closeModal('usersModal')">×¡×’×•×¨</button></div></div>
    <div id="researchModal" class="modal"><div class="modal-content"><h3>×§×¨×™××” ×œ×—×•×§×¨×™×</h3><p>×—×•×§×¨×™× ××•×–×× ×™× ×œ×”×©×ª××© ×‘××¤×œ×™×§×¦×™×” ×œ××—×§×¨. ×ª× ××™ ×™×—×™×“: ×¨×¤×¨× ×¡ ×‘×¨×•×¨ ×œ×“×§×œ ×¦×™×“×•×Ÿ, ×™×©×™ ×–×‘×•×œ×•×Ÿ ×•-MirrorFace.</p><button class="close-modal" onclick="closeModal('researchModal')">×¡×’×•×¨</button></div></div>

    <video id="videoElement" playsinline autoplay muted></video>
    <canvas id="mainCanvas"></canvas>
    <canvas id="tempCanvas" style="display:none"></canvas>

    <div id="ui">
        <div id="slider-container">
            <input type="range" id="symmetrySlider" min="0" max="100" value="50" oninput="manualAdjust(this.value)">
            <div style="display:flex; justify-content:space-between; font-size:10px; opacity:0.7;"><span>×™×“× ×™</span><span onclick="resetAuto()" style="cursor:pointer; text-decoration:underline;">××•×˜×•××˜×™ ğŸ”„</span></div>
        </div>
        <div class="controls-row">
            <button onclick="setMode('none')" id="btnNone" class="tool-btn active">×¨×’×™×œ</button>
            <button onclick="setMode('left')" id="btnLeft" class="tool-btn">×©×××œ</button>
            <button onclick="setMode('right')" id="btnRight" class="tool-btn">×™××™×Ÿ</button>
            <button onclick="toggleGuide()" id="btnGuide" class="tool-btn">ğŸ‘ï¸</button>
            <button onclick="takeSnapshot()" class="tool-btn">ğŸ“¸</button>
        </div>
    </div>
    <div class="watermark">Â© 2026 | MirrorFace | Developed by Dekel Tzidon & Yishay Zvulun</div>

    <script>
        const video = document.getElementById('videoElement');
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const tempCanvas = document.getElementById('tempCanvas');
        const tCtx = tempCanvas.getContext('2d');
        const slider = document.getElementById('symmetrySlider');
        let currentMode = 'none', smoothNoseX = 0, selfieSegmentation, isManual = false, showGuide = true;

        function showScreen(num) {
            document.querySelectorAll('.screen').forEach(s => { s.style.opacity = '0'; setTimeout(() => s.style.display = 'none', 400); });
            setTimeout(() => { const t = document.getElementById('screen-' + num); t.style.display = 'flex'; setTimeout(() => t.style.opacity = '1', 50); }, 450);
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        async function startCamera() {
            document.querySelectorAll('.screen').forEach(s => s.style.opacity = '0');
            setTimeout(() => { document.querySelectorAll('.screen').forEach(s => s.style.display = 'none'); canvas.style.display = 'block'; document.getElementById('ui').style.display = 'flex'; }, 450);
            await initModels();
        }

        async function initModels() {
            await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
            await faceapi.nets.faceLandmark68Net.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
            selfieSegmentation = new SelfieSegmentation({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`});
            selfieSegmentation.setOptions({ modelSelection: 1 });
            selfieSegmentation.onResults(onResults);
            const s = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
            video.srcObject = s;
            video.onloadedmetadata = () => { canvas.width = tempCanvas.width = video.videoWidth; canvas.height = tempCanvas.height = video.videoHeight; smoothNoseX = canvas.width/2; sendToSegmentation(); };
        }

        async function sendToSegmentation() { if (!video.paused && !video.ended) await selfieSegmentation.send({image: video}); requestAnimationFrame(sendToSegmentation); }

        function onResults(r) {
            tCtx.save(); tCtx.clearRect(0,0,canvas.width,canvas.height); tCtx.translate(canvas.width,0); tCtx.scale(-1,1);
            tCtx.drawImage(r.segmentationMask, 0,0,canvas.width,canvas.height);
            tCtx.globalCompositeOperation = 'source-in'; tCtx.drawImage(r.image, 0,0,canvas.width,canvas.height); tCtx.restore();
            handleFaceDetection();
            ctx.clearRect(0,0,canvas.width,canvas.height);
            if(currentMode==='none') ctx.drawImage(tempCanvas,0,0);
            else if(currentMode==='left') drawSymmetry(0, smoothNoseX);
            else drawSymmetry(smoothNoseX, canvas.width - smoothNoseX);
            if(showGuide && (isManual || currentMode!=='none')) {
                ctx.beginPath(); ctx.strokeStyle='rgba(78,186,186,0.4)'; ctx.moveTo(smoothNoseX,0); ctx.lineTo(smoothNoseX,canvas.height); ctx.stroke();
            }
        }

        async function handleFaceDetection() {
            if(!isManual) {
                const d = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks();
                if(d.length > 0) {
                    const nx = canvas.width - d[0].landmarks.getNose()[0].x;
                    smoothNoseX += (nx - smoothNoseX) * 0.15;
                    slider.value = (smoothNoseX/canvas.width)*100;
                }
            }
        }

        function drawSymmetry(sx, w) {
            ctx.drawImage(tempCanvas, sx, 0, w, canvas.height, sx, 0, w, canvas.height);
            ctx.save(); ctx.translate(smoothNoseX * 2, 0); ctx.scale(-1, 1);
            ctx.drawImage(tempCanvas, sx, 0, w, canvas.height, sx, 0, w, canvas.height); ctx.restore();
        }

        function manualAdjust(v) { isManual = true; smoothNoseX = (v/100)*canvas.width; }
        function resetAuto() { isManual = false; }
        function toggleGuide() { showGuide = !showGuide; }
        function setMode(m) { currentMode = m; document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active')); if(m!=='none') document.getElementById('btn'+m.charAt(0).toUpperCase()+m.slice(1)).classList.add('active'); else document.getElementById('btnNone').classList.add('active'); }
        function takeSnapshot() { const l = document.createElement('a'); l.download = 'MirrorFace.png'; l.href = canvas.toDataURL(); l.click(); }
    </script>
</body>
</html>
